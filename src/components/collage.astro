---
import Image from "astro/components/Image.astro";
import type { GalleryPic } from "../types";
import { Images } from "../data/Images";
import Lightbox from "./lightbox.astro";

const pageName = Astro.props["name"];
const images = Images[pageName] || [];

// Agrupar im√°genes en bloques: horizontales solas, verticales de a dos
type Block = GalleryPic | [GalleryPic, GalleryPic];

const blocks: Block[] = [];

for (let i = 0; i < images.length; ) {
    const img = images[i];
    if (img.orientation === "ver") {
        const next = images[i + 1];
        if (next?.orientation === "ver") {
            blocks.push([img, next]);
            i += 2;
        } else {
            blocks.push(img);
            i += 1;
        }
    } else {
        blocks.push(img);
        i += 1;
    }
}
---

<div
    id="collage"
    class="grid gap-3 grid-cols-1 xl:grid-cols-4 px-[5vw] w-full max-w-screen"
>
    {
        blocks.map((block) => {
            if (Array.isArray(block)) {
                const [v1, v2] = block;
                return (
                    <div class="flex flex-row gap-3 w-full">
                        {[v1, v2].map((img) => (
                            <div
                                class="cursor-pointer"
                                style={`width: calc(50% - 0.375rem); aspect-ratio: ${img.width}/${img.height};`}
                                // data-full-img={img.src.src}
                                // data-alt={img.alt}
                            >
                                <Image
                                    src={img.src}
                                    alt={img.alt}
                                    width={img.width}
                                    height={img.height}
                                    class="w-full h-full object-cover lightbox-trigger"
                                    loading="eager"
                                />
                            </div>
                        ))}
                    </div>
                );
            } else {
                return (
                    <div
                        class="cursor-pointer w-full"
                        style={`aspect-ratio: ${block.width}/${block.height};`}
                        data-full-img={block.src.src}
                        data-alt={block.alt}
                    >
                        <Image
                            src={block.src}
                            alt={block.alt}
                            width={block.width}
                            height={block.height}
                            class="w-full h-full object-cover lightbox-trigger"
                            loading="eager"
                        />
                    </div>
                );
            }
        })
    }
</div>

<Lightbox />
